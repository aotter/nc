import{i as W,e as c,s as q,p as z}from"./0e4a7263.js";import{C as y,T as p,I as h,a as g,P as E,R as A}from"./1236a3b0.js";import{L as G}from"./2040bebd.js";import{Q as J,M as K,V as N,W as S}from"./0381570b.js";var U=/\s/;function V(t){for(var r=t.length;r--&&U.test(t.charAt(r)););return r}var X=/^\s+/;function Y(t){return t&&t.slice(0,V(t)+1).replace(X,"")}var D=0/0,Z=/^[-+]0x[0-9a-f]+$/i,tt=/^0b[01]+$/i,rt=/^0o[0-7]+$/i,it=parseInt;function T(t){if(typeof t=="number")return t;if(J(t))return D;if(W(t)){var r=typeof t.valueOf=="function"?t.valueOf():t;t=W(r)?r+"":r}if(typeof t!="string")return t===0?t:+t;t=Y(t);var i=tt.test(t);return i||rt.test(t)?it(t.slice(2),i?2:8):Z.test(t)?D:+t}function nt(t,r,i){return t===t&&(i!==void 0&&(t=t<=i?t:i),r!==void 0&&(t=t>=r?t:r)),t}function et(t,r,i){return i===void 0&&(i=r,r=void 0),i!==void 0&&(i=T(i),i=i===i?i:0),r!==void 0&&(r=T(r),r=r===r?r:0),nt(T(t),r,i)}var ot=function(){return K.Date.now()};const L=ot;var at="Expected a function",st=Math.max,ut=Math.min;function ct(t,r,i){var n,e,f,s,o,u,l=0,v=!1,m=!1,x=!0;if(typeof t!="function")throw new TypeError(at);r=T(r)||0,W(i)&&(v=!!i.leading,m="maxWait"in i,f=m?st(T(i.maxWait)||0,r):f,x="trailing"in i?!!i.trailing:x);function w(a){var d=n,b=e;return n=e=void 0,l=a,s=t.apply(b,d),s}function C(a){return l=a,o=setTimeout(R,r),v?w(a):s}function Q(a){var d=a-u,b=a-l,B=r-d;return m?ut(B,f-b):B}function $(a){var d=a-u,b=a-l;return u===void 0||d>=r||d<0||m&&b>=f}function R(){var a=L();if($(a))return F(a);o=setTimeout(R,Q(a))}function F(a){return o=void 0,x&&n?w(a):(n=e=void 0,s)}function _(){o!==void 0&&clearTimeout(o),l=0,n=u=e=o=void 0}function j(){return o===void 0?s:F(L())}function M(){var a=L(),d=$(a);if(n=arguments,e=this,u=a,d){if(o===void 0)return C(u);if(m)return clearTimeout(o),o=setTimeout(R,r),w(u)}return o===void 0&&(o=setTimeout(R,r)),s}return M.cancel=_,M.flush=j,M}var lt="Expected a function";function ft(t,r,i){var n=!0,e=!0;if(typeof t!="function")throw new TypeError(lt);return W(i)&&(n="leading"in i?!!i.leading:n,e="trailing"in i?!!i.trailing:e),ct(t,r,{leading:n,maxWait:r,trailing:e})}const k={[y]:t=>{c.emit(y,t);const{type:r,tracks:i=[]}=t;switch(k[p]({name:y,tracks:i}),r){case G:{const{url:n}=t;window.open(n,"_blank");break}}},[h]:()=>{c.emit(h)},[g]:(t,r)=>{c.emit(g,t,r)},[E]:t=>{c.emit(E,t)},[A]:t=>{c.emit(A,t)},[p]:t=>{c.emit(p,t),q(t.tracks)}},H=N(),mt=()=>{let t=H,r=null;for(;t&&t.frameElement;)r=t.frameElement,t=t.parent.window;return r},vt=()=>H.frameElement,dt=()=>{const t=[];for(let r=0;r<1.01;r+=.01)t.push(+r.toFixed(2));return t},P=[],I=[],O={[y]:t=>{c.on(y,t)},[h]:(t,r)=>{c.once(h,t);const{impressions:i=[],target:n}=r||{},e=[...i],f=[],s=({intersectionRatio:o,isIntersecting:u},l)=>{if(!e.length){l?.unobserve(n);return}u&&e.forEach((v,m)=>{clearTimeout(f[m]);const{settings:{ratio:x=.5,remain:w=1e3},tracks:C=[]}=v;o>=x&&(f[m]=setTimeout(()=>{k[p]({name:h,tracks:C}),z(e,m),k[h]()},w))})};O[g](s,{target:n})},[g]:(t,r)=>{c.on(g,t);const i=vt(),{target:n=i,threshold:e}=r||{},f={root:null,rootMargin:"0px",threshold:e||dt()},s=([u],l)=>{const{isIntersecting:v,intersectionRatio:m}=u;k[g]({intersectionRatio:m,isIntersecting:v},l)},o=new IntersectionObserver(s,f);n&&o.observe(n),P.push(o)},[E]:t=>{c.on(E,t);const r=S(),i=mt(),n=()=>{var s;const{top:o=0,height:u=0}=((s=i?.getBoundingClientRect)==null?void 0:s.call(i))||{},l=(o+u)/(r.innerHeight+u),v=+et(1-l,0,1).toFixed(2);c.emit(E,{positionRatio:v})},e=I.push(new AbortController)-1,f=ft(({isIntersecting:s})=>{s?r.addEventListener("scroll",n,{passive:!0,signal:I[e].signal}):(I[e].abort(),I[e]=new AbortController)},50);O[g](f,{threshold:[0]})},[A]:t=>{c.once(A,t)},[p]:t=>{c.on(p,t)}},gt=()=>{P.forEach(t=>{t.disconnect()}),I.forEach(t=>{t.abort()}),c.removeAllListeners()};export{gt as destroy,k as emit,O as on};
