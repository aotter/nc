import{e as u,g as S,a as Y,s as _,p as j}from"./ff07de00.js";import{C as T,T as g,I as h,a as p,P as b,R as I}from"./1236a3b0.js";import{L as q}from"./2040bebd.js";import{U as z,r as G,c as R,w as A}from"./0fa97106.js";import{i as O}from"./319454f1.js";var J=/\s/;function K(t){for(var e=t.length;e--&&J.test(t.charAt(e)););return e}var Q=/^\s+/;function V(t){return t&&t.slice(0,K(t)+1).replace(Q,"")}var L=0/0,X=/^[-+]0x[0-9a-f]+$/i,Z=/^0b[01]+$/i,tt=/^0o[0-7]+$/i,et=parseInt;function y(t){if(typeof t=="number")return t;if(z(t))return L;if(O(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=O(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=V(t);var n=Z.test(t);return n||tt.test(t)?et(t.slice(2),n?2:8):X.test(t)?L:+t}function nt(t,e,n){return t===t&&(n!==void 0&&(t=t<=n?t:n),e!==void 0&&(t=t>=e?t:e)),t}function rt(t,e,n){return n===void 0&&(n=e,e=void 0),n!==void 0&&(n=y(n),n=n===n?n:0),e!==void 0&&(e=y(e),e=e===e?e:0),nt(y(t),e,n)}var it=function(){return G.Date.now()};const U=it;var ot="Expected a function",at=Math.max,st=Math.min;function ct(t,e,n){var r,o,s,c,i,l,f=0,v=!1,m=!1,E=!0;if(typeof t!="function")throw new TypeError(ot);e=y(e)||0,O(n)&&(v=!!n.leading,m="maxWait"in n,s=m?at(y(n.maxWait)||0,e):s,E="trailing"in n?!!n.trailing:E);function x(a){var d=r,w=o;return r=o=void 0,f=a,c=t.apply(w,d),c}function H(a){return f=a,i=setTimeout(k,e),v?x(a):c}function P(a){var d=a-l,w=a-f,F=e-d;return m?st(F,s-w):F}function $(a){var d=a-l,w=a-f;return l===void 0||d>=e||d<0||m&&w>=s}function k(){var a=U();if($(a))return B(a);i=setTimeout(k,P(a))}function B(a){return i=void 0,E&&r?x(a):(r=o=void 0,c)}function D(){i!==void 0&&clearTimeout(i),f=0,r=l=o=i=void 0}function N(){return i===void 0?c:B(U())}function M(){var a=U(),d=$(a);if(r=arguments,o=this,l=a,d){if(i===void 0)return H(l);if(m)return clearTimeout(i),i=setTimeout(k,e),x(l)}return i===void 0&&(i=setTimeout(k,e)),c}return M.cancel=D,M.flush=N,M}var lt="Expected a function";function ut(t,e,n){var r=!0,o=!0;if(typeof t!="function")throw new TypeError(lt);return O(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),ct(t,e,{leading:r,maxWait:e,trailing:o})}const C={[T]:t=>{u.emit(T,t);const{type:e,tracks:n=[]}=t;switch(C[g]({name:T,tracks:n}),e){case q:{const{url:r}=t;R.open(r,"_blank");break}}},[h]:t=>{u.emit(h,t)},[p]:(t,e)=>{u.emit(p,t,e)},[b]:t=>{u.emit(b,t)},[I]:(t,e)=>{const{extractColorElement:n,color:r}=e||{},o=r?S(r):n?Y(n):[],{expensiveEvents:s=[],preloadUrls:c=[]}=t;u.emit(I,{colorPalette:o,expensiveEvents:s,preloadUrls:c.filter(Boolean)})},[g]:t=>{u.emit(g,t),_(t.tracks)}},ft=()=>{let t=R,e=null;for(;t&&t.frameElement;)e=t.frameElement,t=t.parent.window;return e},mt=()=>R.frameElement?R.frameElement:null,vt=t=>{let e=t?.parentElement||null;for(;e;){const n=e.scrollHeight>e.clientHeight,r=A.getComputedStyle(e).overflowY.indexOf("hidden")!==-1;if(n&&!r)return e;e=e.parentElement}return A.document.documentElement},dt=()=>{const t=[];for(let e=0;e<1.01;e+=.01)t.push(+e.toFixed(2));return t},W={[T]:t=>{u.on(T,t)},[h]:(t,e)=>{u.once(h,t);const{impressions:n=[],target:r}=e||{},o=[...n],s=[],c=({intersectionRatio:i,isIntersecting:l},f)=>{if(!o.length){f?.unobserve(r);return}l&&o.forEach((v,m)=>{clearTimeout(s[m]);const{settings:{ratio:E=.5,remain:x=1e3},tracks:H=[]}=v;i>=E&&(s[m]=setTimeout(()=>{C[g]({name:h,tracks:H}),j(o,m),C[h](n)},x))})};W[p](c,{target:r})},[p]:(t,e)=>{u.on(p,t);const n=mt(),{target:r=n,threshold:o}=e||{},s={root:null,rootMargin:"0px",threshold:o||dt()},c=([l],f)=>{const{isIntersecting:v,intersectionRatio:m}=l;C[p]({intersectionRatio:m,isIntersecting:v},f)},i=new IntersectionObserver(c,s);r&&i.observe(r)},[b]:t=>{u.on(b,t);const e=ft(),n=vt(e),r=()=>{const{top:i=0,height:l=0}=e?.getBoundingClientRect()||{},f=(i+l)/(n.clientHeight+l),v=+rt(1-f,0,1).toFixed(2);u.emit(b,{positionRatio:v})},o=n===A.document.documentElement?A:n;let s=new AbortController;const c=ut(({isIntersecting:i})=>{i?o.addEventListener("scroll",r,{passive:!0,signal:s.signal}):(s.abort(),s=new AbortController)},100);W[p](c,{threshold:[0]})},[I]:t=>{u.once(I,t)},[g]:t=>{u.on(g,t)}};export{C as emit,W as on};
